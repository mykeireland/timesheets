<!-- ===================== INDEX.HTML ===================== -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Security: Content Security Policy to prevent XSS attacks -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self' https://func-timesheetsNET-api-dev.azurewebsites.net; font-src 'self'; object-src 'none'; base-uri 'self'; form-action 'self';">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="X-Frame-Options" content="DENY">
  <title>Time Entry</title>
  <link rel="stylesheet" href="style.css" />
  <script src="config.js"></script>
</head>
<body>
  <header>
    <div class="header-content">
      <img src="InsightSystems_PrimaryLogo_Rev.png" alt="Insight Systems Logo" class="header-logo" />
      <h1>Time Entry</h1>
    </div>
  </header>
  <div class="container wide">
    <form id="timesheetForm" novalidate>
      <div class="form-row"><label for="employeeSelect">Employee:</label><select id="employeeSelect"></select></div>
      <p><b>Hours (Standard)</b> = Normal hours (7.6hrs/day)</p>
      <p><b>Hours (1.5x)</b> = First 2 hours of OT (Mon–Sat)</p>
      <p><b>Hours (2x)</b> = OT after 2 hours (Mon–Sat), or all Sunday</p>
      <div class="table-responsive">
        <table>
          <thead><tr><th>Date</th><th>Ticket</th><th>Hours (Std/1.5x/2x)</th><th>Notes</th><th>Action</th></tr></thead>
          <tbody><tr>
            <td data-label="Date">
              <label for="entryDate" class="mobile-label">Date</label>
              <input type="date" id="entryDate" />
            </td>
            <td data-label="Ticket">
              <label for="entryTicket" class="mobile-label">Ticket</label>
              <select id="entryTicket"></select>
            </td>
            <td data-label="Hours">
              <div class="hours-grid">
                <div class="hours-input-wrapper">
                  <label for="hoursStd" class="mobile-label">Standard Hours</label>
                  <select id="hoursStd" class="hours-picker">
                    <!-- Populated by JavaScript -->
                  </select>
                  <button type="button" class="preset-btn-single" data-target="hoursStd" data-hours="7.6">Max</button>
                </div>
                <div class="hours-input-wrapper">
                  <label for="hours15" class="mobile-label">Hours at 1.5x</label>
                  <select id="hours15" class="hours-picker">
                    <!-- Populated by JavaScript -->
                  </select>
                  <button type="button" class="preset-btn-single" data-target="hours15" data-hours="2">Max</button>
                </div>
                <div class="hours-input-wrapper">
                  <label for="hours2" class="mobile-label">Hours at 2x</label>
                  <select id="hours2" class="hours-picker">
                    <!-- Populated by JavaScript -->
                  </select>
                  <button type="button" class="preset-btn-single clear-btn" data-clear="true">Clear</button>
                </div>
              </div>
            </td>
            <td data-label="Notes">
              <label for="entryNotes" class="mobile-label">Notes (optional)</label>
              <textarea id="entryNotes" rows="2" placeholder="Notes (optional)"></textarea>
            </td>
            <td data-label="Action">
              <button type="button" id="addToQueueBtn" class="btn light">Add</button>
            </td>
          </tr></tbody>
        </table>
      </div>
      <div id="queuedEntries" style="margin-top:20px; display:none;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
          <h3 style="margin:0;">Queued Entries</h3>
          <input id="queueFilter" class="search-input" type="text" placeholder="Filter queue..." style="max-width:300px;" />
        </div>
        <div class="table-responsive">
          <table>
            <thead><tr>
              <th data-field="date">Date <button class="sort-btn" type="button"><span class="sort-icon">⇅</span></button></th>
              <th data-field="employeeName">Employee <button class="sort-btn" type="button"><span class="sort-icon">⇅</span></button></th>
              <th data-field="ticketName">Ticket <button class="sort-btn" type="button"><span class="sort-icon">⇅</span></button></th>
              <th data-field="hoursStandard">Std <button class="sort-btn" type="button"><span class="sort-icon">⇅</span></button></th>
              <th data-field="hours15x">1.5x <button class="sort-btn" type="button"><span class="sort-icon">⇅</span></button></th>
              <th data-field="hours2x">2x <button class="sort-btn" type="button"><span class="sort-icon">⇅</span></button></th>
              <th data-field="notes">Notes <button class="sort-btn" type="button"><span class="sort-icon">⇅</span></button></th>
              <th>Action</th>
            </tr></thead>
            <tbody id="queueTable"></tbody>
          </table>
        </div>
      </div>
      <div class="form-actions">
        <button type="reset" class="btn secondary">Clear Form</button>
        <button type="button" id="printBtn" class="btn secondary">Print Form</button>
        <button type="submit" class="btn primary">Submit</button>
        <button type="button" id="managerBtn" class="btn danger">Manager View</button>
      </div>
    </form>
  </div>

  <!-- PIN Authentication Modal -->
  <div id="pinModal" class="modal">
    <div class="modal-content">
      <h2>Employee Authentication</h2>
      <p id="pinEmployeeName" style="margin-bottom: 20px; font-weight: bold;"></p>
      <p>Please enter your 4-digit PIN to continue:</p>
      <div style="margin: 20px 0;">
        <input type="password" id="pinInput" maxlength="4" pattern="[0-9]*" inputmode="numeric"
               placeholder="Enter PIN" style="font-size: 1.2em; padding: 10px; width: 150px; text-align: center;" />
      </div>
      <div id="pinError" style="color: #d32f2f; margin-bottom: 10px; display: none;"></div>
      <div style="display: flex; gap: 10px; justify-content: center;">
        <button type="button" id="pinSubmitBtn" class="btn primary">Verify PIN</button>
        <button type="button" id="pinCancelBtn" class="btn secondary">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Change PIN Modal -->
  <div id="changePinModal" class="modal">
    <div class="modal-content">
      <h2>Change Your PIN</h2>
      <p id="changePinEmployeeName" style="margin-bottom: 20px; font-weight: bold;"></p>

      <div style="margin: 15px 0;">
        <label for="currentPinInput">Current PIN:</label>
        <input type="password" id="currentPinInput" maxlength="4" pattern="[0-9]*" inputmode="numeric"
               placeholder="Current PIN" style="font-size: 1em; padding: 8px; width: 150px; display: block; margin: 5px 0;" />
      </div>

      <div style="margin: 15px 0;">
        <label for="newPinInput">New PIN:</label>
        <input type="password" id="newPinInput" maxlength="4" pattern="[0-9]*" inputmode="numeric"
               placeholder="New PIN" style="font-size: 1em; padding: 8px; width: 150px; display: block; margin: 5px 0;" />
      </div>

      <div style="margin: 15px 0;">
        <label for="confirmPinInput">Confirm New PIN:</label>
        <input type="password" id="confirmPinInput" maxlength="4" pattern="[0-9]*" inputmode="numeric"
               placeholder="Confirm PIN" style="font-size: 1em; padding: 8px; width: 150px; display: block; margin: 5px 0;" />
      </div>

      <div id="changePinError" style="color: #d32f2f; margin-bottom: 10px; display: none;"></div>
      <div id="changePinSuccess" style="color: #10b981; margin-bottom: 10px; display: none;"></div>

      <div style="display: flex; gap: 10px; justify-content: center;">
        <button type="button" id="changePinSubmitBtn" class="btn primary">Change PIN</button>
        <button type="button" id="changePinCancelBtn" class="btn secondary">Cancel</button>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>
